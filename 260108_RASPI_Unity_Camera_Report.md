
# 라즈베리파이 기반 로보마스터-Unity 영상 송출 및 디지털 트윈 통신 최적화 연구

## 0. 개요 (Abstract)

본 연구는 로보마스터 EP(이하 로봇)와 라즈베리파이를 연동하여 로봇의 카메라 영상 정보를 취득하고, 이를 Unity 엔진으로 실시간 송출하여 시각화하는 것을 1차 목표로 한다. 초기 연구에서는 로봇 운영체제인 ROS 2(Robot Operating System 2)를 기반으로 한 영상 스트리밍을 시도하였으나, 라즈베리파이 3의 하드웨어 성능 한계로 인한 지속적인 지연(Latency) 및 영상 깨짐(Tearing) 현상이 발생하였다.
**특히, 해상도를 360p 이하로 하향 조정하고 전송 프레임(FPS)을 제한하는 등 데이터 경량화를 시도하였음에도 불구하고, ROS 2 미들웨어의 구조적 오버헤드로 인해 실시간성을 확보하는 데 실패하였다.**
이에 대한 해결책으로 미들웨어를 거치지 않는 **'Direct HTTP 스냅샷(Snapshot)'** 방식을 독자적으로 구현하여 안정적인 영상 송출에 성공하였다.
그러나 본 프로젝트의 최종 목표인 '디지털 트윈(Digital Twin)' 구현을 위해서는 영상 데이터와 로봇의 상태 데이터(위치, 센서값) 간의 실시간 동기화가 필수적이므로, 이원화된 통신 방식 간의 데이터 호환성 및 동기화 전략에 대한 추가적인 연구가 요구된다.

## 1. ROS 2 기반 영상 송출 실패 원인 분석

초기 ROS 2 기반 스트리밍 방식이 실패한 주된 원인은 **라즈베리파이 3 모델의 CPU 처리 성능 한계와 ROS 2 통신 과정의 구조적 오버헤드(Structural Overhead)**로 분석된다. 구체적인 기술적 원인은 다음과 같다.

1. **직렬화/역직렬화(Serialization)의 병목 현상:**
ROS 2 통신은 데이터를 네트워크로 전송하기 위해 직렬화하고, 수신 측에서 다시 역직렬화하는 과정을 거친다. **실험 결과, 영상 해상도를 720p에서 360p로 낮추어 데이터 절대량을 감소시켰음에도 불구하고,** Python 환경에서 매 프레임마다 발생하는 직렬화 연산 비용 자체가 라즈베리파이 3의 CPU 자원을 과도하게 점유하는 것으로 나타났다.
2. **메시지 처리 구조의 비효율성:**
코드 상에서 프레임 레이트(FPS)를 강제로 제한(예: 10 FPS)하더라도, ROS 2 노드 구조상 들어오는 메시지를 수신(Subscribe)하고 큐(Queue)를 관리하는 기본 동작만으로도 상당한 리소스가 소모된다. 즉, **'데이터를 받아서 선별적으로 버리는 행위'**조차 저사양 프로세서에는 부담으로 작용하여, 정작 데이터를 가공하고 Unity로 전송하는 단계에서는 처리 지연이 발생하였다.
3. **결과:**
이러한 구조적 과부하로 인해 데이터 패킷 손실이 발생하였고, Unity 클라이언트 측에서는 불완전한 데이터를 수신하여 화면이 깨지거나 수 초 이상의 지연(Latency)이 발생하는 문제를 초래하였다. 해상도 조절은 지연 시간을 미세하게 단축시킬 뿐, 근본적인 통신 불안정성을 해결하지 못하였다.

결론적으로, 제한된 임베디드 환경에서는 미들웨어(ROS 2)를 거치는 오버헤드를 원천적으로 제거하고, 클라이언트(Unity)가 요청할 때만 최신 프레임을 직접 전송하는 **On-Demand 방식**이 유일한 대안임을 확인하였다.

## 2. 해결 방안 및 호환성 확보 전략 (Architecture Proposal)

현재 라즈베리파이 3의 하드웨어 사양을 유지하면서 안정적인 영상 송출과 디지털 트윈을 동시에 구현하기 위해, **'이원화된 하이브리드 통신 아키텍처(Hybrid Communication Architecture)'**를 제안한다.

### 2-1. 영상 데이터: Direct HTTP 방식 적용 (Data Plane)

* **방식:** ROS 2를 배제하고 Python Flask 서버를 통해 이미지를 직접 송출한다.
* **원리:** Unity 클라이언트가 HTTP 요청(Get)을 보낼 때만 로봇 SDK에서 최신 프레임을 캡처하여 즉시 전송한다.
* **효과:** 불필요한 직렬화 과정과 백그라운드 연산을 제거하여 CPU 점유율을 최소화하고, 전송 지연을 획기적으로 단축하여 실시간성을 확보한다.

### 2-2. 제어 및 센서 데이터: ROS 2 방식 유지 (Control Plane)

* **방식:** 영상에 비해 데이터 크기가 매우 작은 텍스트 기반 데이터(IMU, Odometry, 배터리 정보, 제어 명령 등)는 기존 ROS 2 통신을 사용한다.
* **이유:** ROS 2가 제공하는 강력한 좌표계 변환(TF), 노드 간 통신 안정성, 확장성은 디지털 트윈 제어에 필수적이므로 유지한다. 라즈베리파이 3에서도 텍스트 데이터 처리는 부하가 적어 안정적인 운용이 가능하다.

### 2-3. 호환성 및 동기화(Synchronization) 해결 전략

서로 다른 경로(HTTP vs ROS 2)로 들어오는 데이터의 시점을 일치시키기 위해 **'타임스탬프 매칭(Timestamp Matching)'** 기법을 도입한다.

1. **타임스탬프 생성:** 라즈베리파이(Server)는 모든 데이터를 송신할 때, 시스템의 현재 시간(Unix Time)을 기준으로 고유한 타임스탬프를 생성한다.
2. **데이터 패킹:**
* **ROS 2:** 메시지 헤더(`header.stamp`)에 해당 시간을 포함하여 전송한다.
* **HTTP:** 이미지 응답 헤더(Response Header) 또는 JSON 메타데이터에 동일한 기준의 촬영 시간을 포함하여 전송한다.


3. **Unity 동기화:** Unity(Client)는 수신된 영상과 센서 데이터의 타임스탬프를 비교하여, 오차가 허용 범위(예: 50ms) 이내인 데이터끼리 매핑하여 렌더링한다. 이를 통해 "로봇은 이동했는데 화면은 과거에 머무르는" 이질감을 해소한다.

### 2-4. 결론

본 연구를 통해 하드웨어의 제약 사항을 소프트웨어 아키텍처의 최적화(Direct 전송)로 극복하였으며, 향후 하이브리드 통신 방식을 통해 디지털 트윈의 핵심인 실시간 동기화를 구현할 수 있는 기술적 토대를 마련하였다.